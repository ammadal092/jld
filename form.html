<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>入力に基づく画像表示</title>
    <style>
        img {
            max-width: 500px;
            margin-top: 20px;
        }
        .furigana, .meaning {
            display: none;
            margin-top: 10px;
            color: #333;
        }
        button {
            margin-top: 10px;
        }
        .not-found {
            color: red;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h1>画像を検索するために漢字を入力してください</h1>
    <form id="kanjiForm">
        <label for="kanji">漢字を入力してください: </label>
        <input type="text" id="kanji" name="kanji" required>
        <button type="submit">検索</button>
    </form>

    <h2>検索結果:</h2>
    <div id="imageResults"></div>
    <div id="notFoundResults" class="not-found"></div>

    <div id="furiganaResults">
        <button id="showFurigana">ふりがなを表示</button>
        <div class="furigana" id="furiganaText"></div>
    </div>
    
    <div id="meaningResults">
        <button id="showMeaning">意味を表示</button>
        <div class="meaning" id="meaningText"></div>
    </div>

    <script>
        document.getElementById('kanjiForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const inputText = document.getElementById('kanji').value.trim();
            const imageContainer = document.getElementById('imageResults');
            const notFoundContainer = document.getElementById('notFoundResults');
            imageContainer.innerHTML = '';
            notFoundContainer.innerHTML = '';

            const folderPath = '漢字/';
            const extensions = ['.png', '.jpg'];
            const maxSuffix = 10;

            const foundImages = [];
            const kanjiFound = {};
            let totalToCheck = 0;
            let totalChecked = 0;

            // Untuk tiap karakter kanji
            for (let c = 0; c < inputText.length; c++) {
                const kanjiChar = inputText[c];
                kanjiFound[kanjiChar] = false;

                for (let ext of extensions) {
                    checkImage(kanjiChar, folderPath + kanjiChar + ext);
                    for (let i = 1; i <= maxSuffix; i++) {
                        let num = String(i).padStart(3, '0');
                        checkImage(kanjiChar, folderPath + kanjiChar + num + ext);
                    }
                }
            }

            function checkImage(kanjiChar, path) {
                totalToCheck++;
                let img = new Image();
                img.src = path;

                img.onload = function () {
                    if (!kanjiFound[kanjiChar]) {
                        kanjiFound[kanjiChar] = true;
                    }
                    foundImages.push(path);
                    checkDone();
                };

                img.onerror = function () {
                    checkDone();
                };
            }

            function checkDone() {
                totalChecked++;
                if (totalChecked === totalToCheck) {
                    displayResults();
                }
            }

            function displayResults() {
                if (foundImages.length === 0) {
                    imageContainer.innerHTML = `<p style="color:red;">入力された漢字に該当する画像は見つかりませんでした。</p>`;
                } else {
                    foundImages.forEach(function(image) {
                        imageContainer.innerHTML += `<img src="${image}" alt="画像">`;
                    });
                }

                // Tampilkan karakter yang tidak ditemukan
                let notFoundList = [];
                for (let char in kanjiFound) {
                    if (!kanjiFound[char]) {
                        notFoundList.push(char);
                    }
                }

                if (notFoundList.length > 0) {
                    notFoundContainer.innerHTML = `画像が見つからなかった漢字: <strong>${notFoundList.join(', ')}</strong>`;
                }
            }
        });

        document.getElementById('showFurigana').addEventListener('click', function() {
            const text = document.getElementById('furiganaText');
            if (text.style.display === 'none' || text.style.display === '') {
                text.style.display = 'block';
                text.textContent = '例: これはふりがなです';
                this.textContent = 'ふりがなを非表示';
            } else {
                text.style.display = 'none';
                this.textContent = 'ふりがなを表示';
            }
        });

        document.getElementById('showMeaning').addEventListener('click', function() {
            const text = document.getElementById('meaningText');
            if (text.style.display === 'none' || text.style.display === '') {
                text.style.display = 'block';
                text.innerHTML = '意味例: 漢字は日本語の文字で、意味を持っています。';
                this.textContent = '意味を非表示';
            } else {
                text.style.display = 'none';
                this.textContent = '意味を表示';
            }
        });
    </script>

</body>
</html>
